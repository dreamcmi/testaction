name: lua-esp
on:
  push:
    branches: [ master ]
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
jobs:
  build:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - name: pwd
        run: |
          pwd
          python3 -m pip install --upgrade pip3
      - name: get esp-idf
        run: |
          cd ~
          mkdir -p ~/esp
          cd ~/esp
          git clone --recursive https://github.com/espressif/esp-idf.git
          cd ~/esp/esp-idf
          git checkout v4.3.1
          git submodule init
          git submodule update
          ./install.sh
      - name: test idf
        run: |
          cd ~/esp/esp-idf
          source export.sh
          idf.py --version
          cd ~
          git clone https://gitee.com/dreamcmi/LuatOS-ESP32
          cd LuatOS-ESP32
          idf.py set-target esp32c3
          idf.py build
          cd build/
          ls